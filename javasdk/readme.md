# 数据格式描述规范
## 1.设计思路
- 设备统一上传/接收数据,负责和Server交互;
- 模块是数据的载体,用来汇聚,形成最终数据;
- View(视图显示类)设备只上传,Component(控件类)可以上传和监听

## 2.数据格式规范:

1.上行
```json

{
    "token":"werfsd",//模块的Token
    "dataArea":{ //模块的数据
        "k1":"k1",
        "k2":"k2"
    }
}
```

2.下行

```json

{
    "token":"werfsd",//模块的Token
    "dataArea":{ //模块的数据
        "k1":"k1",
        "k2":"k2"
    }
}
```
> 注意:上面是原始数据,可以支持SSL.
## 3.安全性考虑
之前的设备认证只能保证设备是合法的,但是保证不了数据是合法的,又可能会有一种恶意的设备,给服务器提交大量的垃圾数据,从而使得服务器崩溃.针对这种情况,设计了一个非常简单的数据和发行判断的形式:

1.加密过程
```text

+-------------+                              +-------------+
|             |                              |             |
|Module       |                              | toke:24K/=  |
|             |                              |             |
|             |    Base64([Temp,Hum])        | dataArea:{  |
|             |                              |             |
|             | +--------------------------->+ K:V         |
|             |                              | ...         |
|             |                              | }           |
|Temp:100     |                              |             |
|             |                              |             |
|Hum:35       |                              |             |
|             |                              |             |
|             |                              |             |
+-------------+                              +-------------+

```
2.解密过程
```text
                        +-----------------------+
                        |  1. decode token->list|
                        |  2. list.match(fields)?      next action
{token:.,dataArea:{.}}  |  3. yes->pass         |
+---------------------> |  4. no ->deny or drop |   +----------------------->
                        |                       |
                        |                       |
                        |                       |
                        +-----------------------+

```